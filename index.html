<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qbit Trivia üåç</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #1a1a2e; color: white; text-align: center; padding: 20px; }
        .card { background-color: #16213e; padding: 20px; border-radius: 15px; max-width: 500px; margin: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h1 { margin-top: 0; color: #fff; letter-spacing: 2px; }
        
        select {
            padding: 10px;
            font-size: 1em;
            border-radius: 5px;
            border: none;
            background-color: #0f3460;
            color: white;
            cursor: pointer;
            margin-bottom: 15px;
            width: 80%;
        }

        h2 { color: #e94560; min-height: 60px; font-size: 1.4em; }
        .info { color: #aaa; font-size: 0.8em; margin-bottom: 20px; text-transform: uppercase; }
        .btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background-color: #0f3460; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; transition: 0.3s; }
        .btn:hover:not(:disabled) { background-color: #e94560; transform: scale(1.02); }
        .btn:disabled { background-color: #333; cursor: not-allowed; opacity: 0.6; }
        #resultado { margin-top: 20px; font-weight: bold; font-size: 1.2em; min-height: 30px; }
        .siguiente { background-color: #228B22; display: none; margin-top: 20px; }
        .siguiente:hover { background-color: #2eb82e; }
    </style>
</head>
<body>

    <div class="card">
        <h1>QBIT TRIVIA</h1>

        <select id="filtro-idioma" onchange="cargarPregunta()">
            <option value="es-MX">üá≤üáΩ M√©xico (Espa√±ol)</option>
            <option value="en-US">üá∫üá∏ USA (English)</option>
        </select>

        <div class="info">
            <span id="categoria">Categor√≠a</span> ‚Ä¢ <span id="dificultad">Dificultad</span>
        </div>
        
        <h2 id="pregunta">Cargando desaf√≠o...</h2>

        <div id="opciones">
            </div>

        <div id="resultado"></div>
        <button class="btn siguiente" onclick="cargarPregunta()">Siguiente Pregunta ‚û°Ô∏è</button>
    </div>

    <script>
        // CONFIGURACI√ìN DE TU API EN RENDER
        const API_BASE_URL = "https://qbit-e6gb.onrender.com";
        let preguntaActualId = 0; 

        async function cargarPregunta() {
            document.getElementById("resultado").innerText = "";
            document.querySelector(".siguiente").style.display = "none";
            document.getElementById("opciones").innerHTML = "<p>Conectando con Qbit Cloud...</p>";
            document.getElementById("pregunta").innerText = "...";
            
            const selector = document.getElementById("filtro-idioma").value;
            const [idioma, region] = selector.split("-");

            try {
                // Llamada a tu servidor en la nube
                const response = await fetch(`${API_BASE_URL}/pregunta-random?idioma=${idioma}&region=${region}`);
                
                if (response.status === 404) {
                    document.getElementById("pregunta").innerText = "‚ö†Ô∏è No hay preguntas en este idioma.";
                    document.getElementById("opciones").innerHTML = "<small>Falta generar contenido para esta regi√≥n.</small>";
                    return;
                }

                const data = await response.json();
                preguntaActualId = data.id;

                document.getElementById("pregunta").innerText = data.pregunta;
                document.getElementById("dificultad").innerText = data.dificultad;
                document.getElementById("categoria").innerText = data.categoria;
                
                const divOpciones = document.getElementById("opciones");
                divOpciones.innerHTML = "";

                data.opciones.forEach(opcion => {
                    const boton = document.createElement("button");
                    boton.className = "btn";
                    boton.innerText = opcion;
                    boton.onclick = () => enviarRespuesta(opcion);
                    divOpciones.appendChild(boton);
                });

            } catch (error) {
                document.getElementById("pregunta").innerText = "‚ùå Error de conexi√≥n con Qbit.";
                console.error("Error:", error);
            }
        }

        async function enviarRespuesta(respuestaElegida) {
            const divResultado = document.getElementById("resultado");
            divResultado.style.color = "#aaa";
            divResultado.innerText = "Validando en servidor..."; 
            
            const botones = document.querySelectorAll("#opciones .btn");
            botones.forEach(btn => btn.disabled = true);

            try {
                const response = await fetch(`${API_BASE_URL}/validar-respuesta`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        pregunta_id: preguntaActualId,
                        respuesta_elegida: respuestaElegida
                    })
                });
                
                const data = await response.json();

                if (data.resultado === true) {
                    divResultado.style.color = "#4CAF50";
                    divResultado.innerText = "‚úÖ ¬°CORRECTO! +10 pts";
                } else {
                    divResultado.style.color = "#ff4c4c";
                    divResultado.innerText = "‚ùå Incorrecto. Era: " + data.correcta_era;
                }
                
                document.querySelector(".siguiente").style.display = "block";

            } catch (error) {
                divResultado.innerText = "Error en validaci√≥n remota.";
            }
        }

        // Carga inicial
        cargarPregunta();
    </script>
</body>
</html>